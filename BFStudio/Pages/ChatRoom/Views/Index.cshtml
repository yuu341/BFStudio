@model BFStudio.Pages.ChatRoom.Models.ChatRoomModel

@{
    ViewBag.Title = "チャット";
    var signalPath = @BFStudio.Pages.ChatRoom.Signal.ChatConnection.Path;
}

@section Scripts {

    <script type="text/javascript">
        $(function () {
            var con = $.connection("/signal/chat");
            con.start(function () {
                $("#chat-send").click(function () {
                    sendMsg(con);
                });

                $("#chat-msg").keydown(function (e) {
                    if (e.ctrlKey && e.keyCode == 13) {
                        sendMsg(con);
                    }
                });
            });

            con.received(function (data) {

                var list = $("#chat-hist tr.last").before("<tr><td>"+data.SEND_USER_NM + "</td><td>" + data.USER_MSG + "</td></tr>");
            });

        });


        function sendMsg(con) {
            var sender = $("#chat-send");
            var msgr = $("#chat-msg");
            var msg = msgr.val();

            var obj = {
                CHAT_ID: 0,
                ROOM_ID: 0,
                SEND_USER_ID: 0,
                CREATE_DATE: new Date(),
                SEND_USER_NM: "",
                USER_MSG: msg,

            }
            con.send(obj);

            msgr.val(null);

            msgr.focus();

        }
    </script>

}

<div class="col-md-10">
    @*<div id="chat-hist">
        @foreach (var msg in @Model.MessageList)
        {
            <div class="record">
                <ul class="user-info"><li><label>@msg.SEND_USER_NM</label></li></ul><ul class="msg"><li><label>@msg.USER_MSG</label></li></ul>
            </div>

        }
    </div>*@

    <table id="chat-hist" class="table table-striped table-bordered table-hover">
        <thead><tr><th>ユーザ</th><th>履歴</th></tr></thead>
        <tbody>
            @foreach (var msg in @Model.MessageList) {
                <tr><td><label>@msg.SEND_USER_NM</label></td><td><label>@msg.USER_MSG</label></td></tr>
            }
        </tbody>
    </table>
    <div id="user-input-space">
        <input id="chat-msg" class="text-primary" type="text" />
        <input id="chat-send" type="button" class="btn btn-primary" value="送信" />
    </div>
</div>
<div class="col-md-2"></div>